<?xml version="1.0"?>
<project name="iriverter" default="jar" basedir=".">
	<property name="src.dir" value="src" />
	<property name="web.dir" value="web" />
	<property name="build.dir" value="build" />
	<property name="jar.dir" value="jar" />
	<property name="dist.dir" value="dist" />
	<property name="swt.unix.dir" value="lib/swt-M20060921-0945-gtk-linux-x86" />
	<property name="swt.windows.dir" value="lib/swt-M20060921-0945-win32-win32-x86" />
	<property name="doc.dir" value="org/thestaticvoid/iriverter/doc" />
	<property name="xslt.style" value="lib/docbook-xsl-1.71.1/html/chunk.xsl" />
	<property name="xslt.parser.classpath" value="lib/saxon6-5-5-1/saxon.jar" />

	<condition property="swt.dir" value="${swt.unix.dir}">
		<os family="unix" />
	</condition>
	
	<condition property="swt.dir" value="${swt.windows.dir}">
		<os family="windows" />
	</condition>
	
	<target name="compile">
		<mkdir dir="${build.dir}" />

		<copy todir="${build.dir}">
			<fileset dir="${src.dir}">
				<include name="**/icons/*" />
				<include name="**/profiles/*" />
			</fileset> 
		</copy>

		<javac srcdir="${src.dir}" destdir="${build.dir}" classpath="${swt.dir}/swt.jar" />
	</target>

	<target name="doc" depends="compile">
		<copy todir="${build.dir}">
			<fileset dir="${src.dir}" includes="**/doc/images/*" />
		</copy>

		<xslt basedir="${src.dir}" destdir="${build.dir}" includes="${doc.dir}/index.xml" style="${xslt.style}">
			<classpath location="${xslt.parser.classpath}" />
			<param name="base.dir" expression="${build.dir}/${doc.dir}/" />
			<param name="use.id.as.filename" expression="1" />
		</xslt>
	</target>

	<target name="jar" depends="doc">
		<mkdir dir="${jar.dir}" />
		
		<jar destfile="${jar.dir}/iriverter.jar" basedir="${build.dir}" />
	</target>

	<target name="dist" depends="jar">
		<mkdir dir="${dist.dir}" />
		
		<copy file="${jar.dir}/iriverter.jar" todir="${dist.dir}" />
		<signjar jar="${dist.dir}/iriverter.jar" keystore="keystore" alias="iriverter" storepass="iriverter" />

		<copy file="${swt.unix.dir}/swt.jar" tofile="${dist.dir}/swt-gtk-linux-x86.jar" />
		<signjar jar="${dist.dir}/swt-gtk-linux-x86.jar" keystore="keystore" alias="iriverter" storepass="iriverter" />
		
		<jar destfile="${dist.dir}/swt-native-gtk-linux-x86.jar" basedir="${swt.unix.dir}" includes="*.so" />
		<signjar jar="${dist.dir}/swt-native-gtk-linux-x86.jar" keystore="keystore" alias="iriverter" storepass="iriverter" />
		
		<copy file="${swt.windows.dir}/swt.jar" tofile="${dist.dir}/swt-win32-win32-x86.jar" />
		<signjar jar="${dist.dir}/swt-win32-win32-x86.jar" keystore="keystore" alias="iriverter" storepass="iriverter" />
		
		<jar destfile="${dist.dir}/swt-native-win32-win32-x86.jar" basedir="${swt.windows.dir}" includes="*.dll" />
		<signjar jar="${dist.dir}/swt-native-win32-win32-x86.jar" keystore="keystore" alias="iriverter" storepass="iriverter" />
		
		<copy file="${web.dir}/iriverter.gif" todir="${dist.dir}" />
		<copy file="${web.dir}/iriverter.jnlp" todir="${dist.dir}" />
	</target>

	<target name="run" depends="jar">
		<java classname="org.thestaticvoid.iriverter.ConverterUI" fork="true">
			<jvmarg value="-Djava.library.path=${swt.dir}" />
			<classpath>
				<pathelement location="${jar.dir}/iriverter.jar" />
				<pathelement location="${swt.dir}/swt.jar" />
			</classpath>
		</java>
	</target>

	<target name="clean">
		<delete dir="${build.dir}" />
		<delete dir="${jar.dir}" />
		<delete dir="${dist.dir}" />
	</target>
</project>
